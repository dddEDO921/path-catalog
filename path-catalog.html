<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Path Catalog</title>

  <!-- 開発・配布を簡単にするため CDN 版 Tailwind を利用 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-base: #0f172a;
      --bg-layer: #111827;
      --border: #1f2937;
      --accent: #7c3aed;
      --accent-soft: rgba(124, 58, 237, 0.12);
      --accent-soft-strong: rgba(124, 58, 237, 0.15);
      --text-heading: #e5e7eb;
      --text-body: #cbd5e1;
      --text-muted: #9ca3af;
    }

    body {
      font-family: "Noto Sans JP", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-base);
      color: var(--text-body);
    }

    .tab-btn {
      border: 1px solid transparent;
      color: #cbd5e1;
      background-color: transparent;
      padding: 0.4rem 0.9rem;
      border-radius: 0.75rem 0.75rem 0 0;
      font-weight: 600;
      transition: background-color 120ms ease, border-color 120ms ease, color 120ms ease, box-shadow 120ms ease;
    }

    .tab-btn:hover {
      background-color: var(--bg-layer);
      border-color: var(--border);
      color: #ffffff;
    }

    .tab-btn.active {
      background-color: var(--bg-layer);
      border-color: var(--accent);
      color: #ffffff;
      box-shadow: 0 10px 30px -18px rgba(0, 0, 0, 0.9);
    }

    .cat-btn {
      background-color: var(--bg-layer);
      border: 1px solid var(--border);
      color: #e5e7eb;
      transition: background-color 120ms ease, border-color 120ms ease, color 120ms ease, box-shadow 120ms ease;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.03);
      position: relative;
    }

    .cat-btn:hover {
      background-color: var(--accent-soft);
      border-color: var(--accent);
      color: #ffffff;
    }

    .cat-btn.active {
      background-color: var(--bg-layer);
      border-color: var(--accent);
      color: #ffffff;
      box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.35);
    }

    .list-row {
      background-color: transparent;
      border: 1px solid transparent;
    }

    .list-row:hover {
      background-color: var(--accent-soft);
      border-color: var(--accent);
    }

    /* ちょい補助：テキスト省略 */
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>

<body class="text-slate-100">
  <div class="min-h-dvh flex flex-col">

    <header class="border-b backdrop-blur px-5 py-2"
      style="background-color: var(--bg-layer); border-color: var(--border);">
      <div class="grid grid-cols-[260px_1fr] items-end">
        <div class="flex items-center gap-2.5" style="color: var(--text-heading);">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 240" role="img" aria-label="Path Catalog logo"
            class="h-9 w-auto">
            <defs>
              <style>
                .badge {
                  fill: #7c3aed;
                }

                .sqFront {
                  fill: #f8fafc;
                }

                .sqBack {
                  fill: #e2e8f0;
                  opacity: 0.55;
                }

                .slash {
                  stroke: #f8fafc;
                  stroke-width: 22;
                  stroke-linecap: round;
                  fill: none;
                }

                .wordMain {
                  fill: #f8fafc;
                  font-family: "Noto Sans JP", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                  font-size: 88px;
                  font-weight: 700;
                  letter-spacing: -0.02em;
                }

                .wordSub {
                  fill: #cbd5e1;
                  font-family: "Noto Sans JP", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                  font-size: 88px;
                  font-weight: 600;
                  letter-spacing: -0.02em;
                }
              </style>
            </defs>
            <g transform="translate(24,24) scale(0.72)">
              <rect class="badge" x="16" y="16" width="224" height="224" rx="64" />
              <path class="slash" d="M50 165 L94 91" />
              <rect class="sqBack" x="136" y="80" width="80" height="80" rx="12" />
              <rect class="sqFront" x="116" y="96" width="80" height="80" rx="12" />
            </g>
            <g transform="translate(280,150)">
              <text x="0" y="0" class="wordMain">Path</text>
              <text x="205" y="0" class="wordSub">Catalog</text>
            </g>
          </svg>
        </div>
        <div id="tabNav" class="flex flex-wrap items-end gap-1.5 pt-1 pb-1 -mb-[1px]"></div>
      </div>
    </header>

    <div class="grid grid-cols-[260px_1fr] flex-1">

      <!-- Sidebar -->
      <aside class="border-r" style="background-color: var(--bg-base); border-color: var(--border);">
        <div class="p-4 sticky top-0">
          <div class="flex items-center justify-between">
            <h2 class="text-xs font-semibold" style="color: var(--text-heading);">カテゴリ</h2>
            <span id="tabIndicator" class="text-[10px]" style="color: var(--text-muted);"></span>
          </div>

          <nav class="mt-2 space-y-1" id="catList"></nav>

          <div class="mt-4 text-[11px]" style="color: var(--text-muted);">
            <p>操作:</p>
            <ul class="list-disc ml-4 mt-1 space-y-1">
              <li>カテゴリで絞り込み</li>
              <li>カードをクリックするとパスをコピー</li>
            </ul>
          </div>
        </div>
      </aside>

      <!-- Main -->
      <main class="p-5 space-y-4" style="background-color: var(--bg-base);">
        <section id="list" class="grid grid-cols-1 xl:grid-cols-2 gap-4"></section>

        <section id="empty" class="hidden mt-10">
          <div class="rounded-2xl border border-dashed border-slate-800 bg-slate-900 p-10 text-center"
            style="color: var(--text-muted);">
            条件に一致するデータがありません
          </div>
        </section>
      </main>
    </div>
  </div>

  <script src="data.js"></script>

  <script>
    (() => {
      // DOM helper / 安全変換
      const $ = (id) => document.getElementById(id);
      const safe = (v) => (v ?? "").toString();
      const escapeHtml = (str) => str.replace(/[&<>"']/g, (m) => ({
        "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#039;"
      }[m]));
      const uniq = (arr) => Array.from(new Set(arr));
      const typeIcon = {
        url: `<svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M10.5 13.5 7 17a4 4 0 1 1-5.7-5.6l4-4a4 4 0 0 1 5.6 0M13.5 10.5 17 7a4 4 0 0 1 5.7 5.6l-4 4a4 4 0 0 1-5.6 0"/><path d="m8 16 8-8"/></svg>`,
        file: `<svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M7 3h7l5 5v11a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M14 3v5h5"/></svg>`,
        folder: `<svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"/></svg>`,
        unknown: `<svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 9a2.5 2.5 0 1 1 3.9 2 2.5 2.5 0 0 0-1.4 2.2V14"/><path d="M12 18.01l.01-.011"/><rect x="4" y="4" width="16" height="16" rx="3"/></svg>`
      };
      // パス種別（UNC/ドライブもファイル・フォルダに分類）とバッジ情報
      const classifyPath = (path) => {
        const p = path || "";
        const isUrl = /^https?:\/\//i.test(p);
        if (isUrl) return { type: "url", icon: typeIcon.url };
        const isUnc = /^\\\\/.test(p);
        const isDrive = /^[a-zA-Z]:\\/.test(p);
        const hasExt = /\.[a-z0-9]{1,5}$/i.test(p);
        if (isUnc || isDrive) {
          return hasExt
            ? { type: "file", icon: typeIcon.file }
            : { type: "folder", icon: typeIcon.folder };
        }
        if (hasExt) return { type: "file", icon: typeIcon.file };
        if (/[\\\/]/.test(p)) return { type: "folder", icon: typeIcon.folder };
        return { type: "unknown", icon: typeIcon.unknown };
      };
      // カテゴリ名から安定した色を生成
      const colorForCat = (cat) => {
        const key = (cat || "").split("").reduce((n, c) => n + c.charCodeAt(0) * 7, 0);
        const hue = key % 360;
        const saturation = 65;
        const lightness = 60;
        const base = `hsl(${hue}deg ${saturation}% ${lightness}%)`;
        const alpha = (a) => `hsl(${hue}deg ${saturation}% ${lightness}% / ${a})`;
        return { base, alpha };
      };

      // カード上に短時間出すミニトースト
      const inlineToast = (parent, msg) => {
        if (!parent) return;
        const tag = document.createElement("span");
        tag.className = "absolute right-2 top-1/2 -translate-y-1/2 transform rounded-full bg-slate-900/90 text-[10px] px-2 py-0.5 border border-slate-700 shadow";
        tag.style.color = "var(--text-heading)";
        tag.textContent = msg;
        parent.appendChild(tag);
        setTimeout(() => tag.remove(), 900);
      };

      // クリップボードコピー + インライン表示
      const copyText = async (text, targetEl) => {
        await navigator.clipboard.writeText(text);
        inlineToast(targetEl, "コピーしました");
      };

      // ノート用ツールチップ（行外に出すため body 直下に生成）
      const noteTooltip = (() => {
        const el = document.createElement("div");
        el.id = "note-tooltip";
        el.style.position = "fixed";
        el.style.zIndex = "9999";
        el.style.pointerEvents = "none";
        el.style.opacity = "0";
        el.style.transition = "opacity 120ms ease, transform 120ms ease";
        el.className = "max-w-md whitespace-pre-line rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-[10px] shadow-lg";
        el.style.color = "var(--text-heading)";
        document.body.appendChild(el);
        let showTimer;
        return {
          show(text, x, y) {
            el.textContent = text;
            el.style.left = `${x}px`;
            el.style.top = `${y}px`;
            el.style.opacity = "1";
            el.style.transform = "translate(-8px, 6px)";
            clearTimeout(showTimer);
          },
          hide() {
            el.style.opacity = "0";
          }
        };
      })();

      const DEFAULT_TAB = "共通";

      // 外部データを安全な形に正規化
      const normalize = (items) => (items || []).map((x, i) => ({
        id: i + 1,
        tab: safe(x.tab || DEFAULT_TAB),
        category: safe(x.category),
        subCategory: safe(x.subCategory),
        name: safe(x.name),
        path: safe(x.path),
        note: safe(x.note)
      }));

      function normalizeCatalog(raw) {
        const warnings = [];
        const items = [];

        const warn = (msg, meta) => warnings.push({ msg, meta });

        if (!Array.isArray(raw)) {
          warn("window.PATH_CATALOG が配列ではありません", { type: typeof raw });
          return { items, warnings };
        }

        for (let t = 0; t < raw.length; t++) {
          const tabBlock = raw[t];
          if (!Array.isArray(tabBlock) || tabBlock.length < 2) {
            warn("タブブロックが不正です", { t, tabBlock });
            continue;
          }
          const tab = String(tabBlock[0] ?? "").trim();
          const categories = tabBlock[1];

          if (!Array.isArray(categories)) {
            warn("カテゴリ配列が不正です", { t, tab });
            continue;
          }

          for (let c = 0; c < categories.length; c++) {
            const catBlock = categories[c];
            if (!Array.isArray(catBlock) || catBlock.length < 2) {
              warn("カテゴリブロックが不正です", { t, c, catBlock });
              continue;
            }
            const category = String(catBlock[0] ?? "").trim();
            const subs = catBlock[1];

            if (!Array.isArray(subs)) {
              warn("サブカテゴリ配列が不正です", { t, tab, c, category });
              continue;
            }

            for (let s = 0; s < subs.length; s++) {
              const subBlock = subs[s];
              if (!Array.isArray(subBlock) || subBlock.length < 2) {
                warn("サブカテゴリブロックが不正です", { t, c, s, subBlock });
                continue;
              }
              const subCategory = String(subBlock[0] ?? "").trim(); // 空OK
              const rows = subBlock[1];

              if (!Array.isArray(rows)) {
                warn("アイテム配列が不正です", { t, tab, c, category, s, subCategory });
                continue;
              }

              for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                if (!Array.isArray(row)) {
                  warn("アイテム行が配列ではありません", { t, c, s, i, row });
                  continue;
                }

                // 3列固定だが、不足は補完（止めない）
                if (row.length !== 3) {
                  warn("アイテム行の列数が3ではありません（不足は空で補完）", { t, c, s, i, cols: row.length });
                }

                const name = String(row[0] ?? "").trim();
                const path = row[1] ?? "";
                const note = String(row[2] ?? ""); // 空OK

                if (!name) warn("name が空です（表示は継続）", { t, c, s, i });
                if (!path) warn("path が空です（表示は継続）", { t, c, s, i });

                items.push({
                  tab: tab || "未分類",
                  category,
                  subCategory,
                  name,
                  path,
                  note,
                  _meta: { t, c, s, i }
                });
              }
            }
          }
        }

        return { items, warnings };
      };

      const { items, warnings } = normalizeCatalog(window.PATH_CATALOG);

      const state = {
        all: normalize(items),
        tab: "",
        cat: "",
      };

      const filtered = () => state.all.filter(x => {
        if (state.tab && x.tab !== state.tab) return false;
        if (state.cat && x.category !== state.cat) return false;
        return true;
      });

      const renderTabList = () => {
        const holder = $("tabNav");
        if (!holder) return;
        const tabs = uniq(state.all.map(x => x.tab || DEFAULT_TAB));
        if (!state.tab && tabs.length) state.tab = tabs[0];
        const current = state.tab;

        holder.innerHTML = tabs.map(tab => {
          const isSel = current === tab;
          return `
            <button
              class="tab-btn ${isSel ? "active" : ""}"
              data-tab="${escapeHtml(tab)}">
              ${escapeHtml(tab)}
            </button>
          `;
        }).join("");

        holder.querySelectorAll("button[data-tab]").forEach(btn => {
          btn.addEventListener("click", () => {
            state.tab = btn.getAttribute("data-tab") || "";
            state.cat = "";
            renderTabList();
            renderCategoryList();
            renderMain();
          });
        });
      };

      const renderCategoryList = () => {
        const cats =
          uniq(
            state.all
              .filter(x => !state.tab || x.tab === state.tab)
              .map(x => x.category)
              .filter(Boolean)
          );
        if (state.cat && !cats.includes(state.cat)) state.cat = "";
        const current = state.cat;
        const tabBadge = $("tabIndicator");
        if (tabBadge) {
          tabBadge.textContent = state.tab ? `タブ: ${state.tab}` : "";
        }

        const allBtn = `
          <button class="w-full text-left rounded-xl px-3 py-1.5 text-sm mt-1 mb-1 cat-btn ${current === "" ? "active" : ""}"
                  data-cat="">
            すべて
          </button>`;

        $("catList").innerHTML = allBtn + cats.map(c => {
          const color = colorForCat(c);
          const isSel = current === c;
          return `
            <button class="w-full text-left rounded-xl px-3 py-1.5 text-sm mt-1 mb-1 cat-btn ${isSel ? "active" : ""}"
                    data-cat="${escapeHtml(c)}">
              <span class="inline-block h-1 w-3 rounded-full mr-2 align-middle" style="background-color:${color.alpha(0.6)};"></span>
              <span class="align-middle">${escapeHtml(c)}</span>
            </button>
          `;
        }).join("");

        $("catList").querySelectorAll("button[data-cat]").forEach(btn => {
          btn.addEventListener("click", () => {
            state.cat = btn.getAttribute("data-cat") || "";
            renderCategoryList();
            renderMain();
          });
        });
      };

      const listRow = (item) => {
        const meta = classifyPath(item.path);
        const c = colorForCat(item.category || "");
        const iconHtml = (meta.icon || "").trim();
        return `
          <li class="group relative z-0 hover:z-10 cursor-pointer px-0 py-1 rounded-md shadow-sm grid grid-cols-[18px_150px_minmax(0,1fr)] gap-x-3 gap-y-0.5 items-center transition overflow-visible list-row"
              data-copy="${escapeHtml(item.path)}"
              data-note="${item.note ? escapeHtml(item.note) : ""}">
            <div class="w-0.5 rounded-full opacity-30 group-hover:opacity-90 transition col-span-3" style="background: linear-gradient(180deg, var(--accent) 0%, rgba(124,58,237,0.65) 100%);"></div>
            <div class="flex h-4 items-center justify-center text-[12px] leading-none col-start-1 col-span-1 z-10" style="color:${c.base};">
              ${iconHtml}
            </div>
            <div class="text-[13px] font-normal leading-snug break-words col-start-2 col-span-1" style="color: var(--text-heading);">
              ${escapeHtml(item.name || "(no name)")}
            </div>
            <div class="relative text-[11px] font-mono break-all tabular-nums col-start-3 col-span-1 pr-7" style="color: var(--text-muted);">
              ${escapeHtml(item.path)}
              ${item.note ? `
                <span class="absolute right-0 top-1/2 -translate-y-1/2 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-700 text-[9px] bg-slate-900/80" style="color: var(--text-muted);">i</span>
              ` : ""}
            </div>
          </li>
        `;
      };

      const renderMain = () => {
        const items = filtered();
        const list = $("list");
        const empty = $("empty");

        const s1 = $("stats");
        if (s1) s1.textContent = "";

        if (items.length === 0) {
          list.innerHTML = "";
          empty.classList.remove("hidden");
          return;
        }
        empty.classList.add("hidden");

        const catMap = {};
        items.forEach(item => {
          const cat = item.category || "(未設定カテゴリ)";
          const sub = item.subCategory || "(未設定)";
          if (!catMap[cat]) catMap[cat] = {};
          if (!catMap[cat][sub]) catMap[cat][sub] = [];
          catMap[cat][sub].push(item);
        });
        const catLabels = Object.keys(catMap);

        list.innerHTML = catLabels.map(cat => {
          const color = colorForCat(cat);
          const subMap = catMap[cat];
          const subLabels = Object.keys(subMap);
          return `
          <div class="rounded-xl border shadow-lg ring-1 overflow-hidden" style="background-color: var(--bg-layer); box-shadow: 0 8px 24px -12px rgba(0,0,0,0.8), 0 0 0 1px ${color.alpha(0.15)}; border-color: var(--border);">
            <div class="px-4 py-2 grid grid-cols-[18px_1fr] items-center gap-3 border-b" style="background-color: ${color.alpha(0.25)}; border-color: var(--border);">
              <span class="inline-block h-1.5 w-5 rounded-full" style="background-color:${color.base};"></span>
              <div class="text-base font-semibold leading-tight" style="color: var(--text-heading);">${escapeHtml(cat)}</div>
            </div>
            <div class="p-3 space-y-3">
              ${subLabels.map(sub => `
                <div class="space-y-1.5">
                  <div class="flex items-center gap-2 px-2 py-0.5">
                    <span class="inline-block h-1 w-3 rounded-full" style="background-color:${color.base};"></span>
                    <span class="text-sm font-semibold tracking-wide uppercase" style="color: var(--text-heading);">
                      ${escapeHtml(sub)}
                    </span>
                  </div>
                  <ul class="space-y-0.75 pl-5 ml-3 border-l" style="border-color:${color.alpha(0.35)};">
                    ${subMap[sub].map(listRow).join("")}
                  </ul>
                </div>
              `).join("")}
            </div>
          </div>
          `;
        }).join("");

        list.querySelectorAll("li[data-copy]").forEach(el => {
          el.addEventListener("click", async () => {
            const p = el.getAttribute("data-copy") || "";
            try {
              await copyText(p, el);
            } catch (e) {
              const ta = document.createElement("textarea");
              ta.value = p;
              document.body.appendChild(ta);
              ta.select();
              document.execCommand("copy");
              ta.remove();
              inlineToast(el, "コピーしました");
            }
          });
        });

        // ノートツールチップ（body直下で表示）
        list.querySelectorAll("li[data-note]").forEach(el => {
          const note = el.getAttribute("data-note") || "";
          if (!note) return;
          el.addEventListener("mouseenter", (e) => {
            const rect = el.getBoundingClientRect();
            noteTooltip.show(note, rect.right + 36, rect.bottom);
          });
          el.addEventListener("mousemove", (e) => {
            noteTooltip.show(note, e.clientX + 36, e.clientY);
          });
          el.addEventListener("mouseleave", () => noteTooltip.hide());
        });
      };

      const renderAll = () => {
        renderTabList();
        renderCategoryList();
        renderMain();
      };

      renderAll();
    })();
  </script>
</body>

</html>